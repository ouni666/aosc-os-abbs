abinfo "Building xstreamingdesktop ..."
# Note:Use third-party electron to support loongarch64
if ab_match_arch loongarch64; then ELECTRON_MIRROR="https://github.com/darkyzhou/electron-loong64/releases/download/" electron_use_remote_checksums=1 yarn install electron@35.4.0
yarn build
abinfo "Installing xstreamingdesktop ..."
mkdir -pv "$PKGDIR"/usr/lib/xstreamingdesktop/
cp -av "$SRCDIR"/dist/linux-unpacked/* "$PKGDIR"/usr/lib/xstreamingdesktop
chmod +x "$PKGDIR"/usr/lib/xstreamingdesktop/xstreaming

mkdir -pv "$PKGDIR"/usr/bin
ln -sv ../lib/$PKGNAME/xstreaming "$PKGDIR"/usr/bin/xstreamingdesktop

abinfo "Installing icon ..."
mkdir -pv "$PKGDIR"/usr/share/pixmaps/
install -v -m644 "$SRCDIR"/resources/XStreaming.png "$PKGDIR"/usr/share/pixmaps/

abinfo "Installing .desktop entry ..."
DESKTOP_FILE="$PKGDIR"/usr/share/applications/XStreamingDesktop.desktop
mkdir -pv "$(dirname "$DESKTOP_FILE")"
cat > "$DESKTOP_FILE" << EOF
[Desktop Entry]
Name=XStreamingDesktop
Exec=/usr/lib/$PKGNAME/xstreaming
Icon=XStreaming
Terminal=false
Type=Application
Categories=Game;
EOF
chmod 644 "$DESKTOP_FILE"

fi

yarn install
yarn build

abinfo "Installing xstreamingdesktop ..."
mkdir -pv "$PKGDIR"/usr/lib/xstreamingdesktop/
cp -av "$SRCDIR"/dist/linux-unpacked/* "$PKGDIR"/usr/lib/xstreamingdesktop
chmod +x "$PKGDIR"/usr/lib/xstreamingdesktop/xstreaming

mkdir -pv "$PKGDIR"/usr/bin
ln -sv ../lib/$PKGNAME/xstreaming "$PKGDIR"/usr/bin/xstreamingdesktop

abinfo "Installing icon ..."
mkdir -pv "$PKGDIR"/usr/share/pixmaps/
install -v -m644 "$SRCDIR"/resources/XStreaming.png "$PKGDIR"/usr/share/pixmaps/

abinfo "Installing .desktop entry ..."
DESKTOP_FILE="$PKGDIR"/usr/share/applications/XStreamingDesktop.desktop
mkdir -pv "$(dirname "$DESKTOP_FILE")"
cat > "$DESKTOP_FILE" << EOF
[Desktop Entry]
Name=XStreamingDesktop
Exec=/usr/lib/$PKGNAME/xstreaming
Icon=XStreaming
Terminal=false
Type=Application
Categories=Game;
EOF
chmod 644 "$DESKTOP_FILE"
