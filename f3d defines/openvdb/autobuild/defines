PKGNAME=openvdb
PKGDES="C++ library comprising a novel hierarchical data structure"
PKGSEC=libs
PKGDEP="boost tbb c-blosc zlib openexr libpng ncurses libffi libxml2 \
        llvm-runtime jemalloc imath glfw"
# FIXME: Broken CUDA detection since Core 13.
#PKGSUG__AMD64="cuda"
#PKGSUG__ARM64="cuda"
BUILDDEP="llvm pybind11 texlive nanobind"
# FIXME: Broken CUDA detection since Core 13.
#BUILDDEP__AMD64="$BUILDDEP cuda"
#BUILDDEP__ARM64="$BUILDDEP cuda"

ABTYPE=cmakeninja
# FIXME: NanoVDB tools does not build since Core 13.
#
# [...]/nanovdb/nanovdb/../nanovdb/util/GridBuilder.h: In member function ‘bool nanovdb::build::LeafNode<BuildT>::ValueIterator::isActive() const’:
# [...]/nanovdb/nanovdb/../nanovdb/util/GridBuilder.h:1161:72: error: ‘const struct nanovdb::build::LeafNode<BuildT>’ has no member named ‘isActive’ [-Wtemplate-body]
#  1161 |         bool isActive() const { NANOVDB_ASSERT(*this); return mParent->isActive(mPos);}
#       |
CMAKE_AFTER=(
	-DOPENVDB_BUILD_NANOVDB=ON
	-DNANOVDB_BUILD_TOOLS=OFF
	-DNANOVDB_USE_MAGICAVOXEL=ON
	-DNANOVDB_USE_OPENVDB=ON
	-DOPENVDB_CORE_SHARED=ON
	-DOPENVDB_CORE_STATIC=OFF
	-DOPENVDB_BUILD_CORE=ON
	-DOPENVDB_BUILD_BINARIES=ON
	-DOPENVDB_BUILD_NANOVDB=ON
	-DOPENVDB_BUILD_PYTHON_MODULE=ON
	-DOPENVDB_BUILD_UNITTESTS=OFF
	-DOPENVDB_BUILD_VDB_LOD=ON
	-DOPENVDB_BUILD_VDB_PRINT=ON
	-DOPENVDB_BUILD_VDB_RENDER=ON
	-DOPENVDB_BUILD_VDB_TOOL=ON
	-DOPENVDB_BUILD_VDB_VIEW=ON
	-DOPENVDB_BUILD_DOCS=OFF
	-DOPENVDB_BUILD_HOUDINI_PLUGIN=OFF
	-DOPENVDB_BUILD_MAYA_PLUGIN=OFF
	-DUSE_HOUDINI=OFF
	-DUSE_MAYA=NO
	-DUSE_TBB=ON
	-DUSE_NANOVDB=ON
	-DUSE_BLOSC=ON
	-DUSE_ZLIB=ON
	-DUSE_LOG4CPLUS=OFF
	-DUSE_EXR=ON
	-DUSE_IMATH_HALF=ON
	-DUSE_PNG=ON
	-DUSE_AX=ON
)

CMAKE_AFTER__INTRIN=(
	-DNANOVDB_USE_INTRINSICS=ON
)
# FIXME: Broken CUDA detection since Core 13.
CMAKE_AFTER__CUDA=(
	-DNANOVDB_USE_CUDA=OFF
)

CMAKE_AFTER__AMD64=(
	"${CMAKE_AFTER[@]}"
	"${CMAKE_AFTER__CUDA[@]}"
	"${CMAKE_AFTER__INTRIN[@]}"
)
CMAKE_AFTER__ARM64=(
	"${CMAKE_AFTER[@]}"
	"${CMAKE_AFTER__CUDA[@]}"
	"${CMAKE_AFTER__INTRIN[@]}"
)

PKGBREAK="superslicer<=2.5.59.3-0 openimageio<=2.4.12.0-3 blender<=3.6.4-0"
