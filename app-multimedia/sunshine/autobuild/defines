PKGNAME=sunshine
PKGDES="A Gamestream host for Moonlight"
PKGSEC=video
PKGDEP="pulseaudio libdrm libevdev icu wayland openssl ffmpeg miniupnpc \
        libnotify libappindicator libvdpau mesa nlohmann-json"
PKGRECOM="avahi"
BUILDDEP="boost nodejs doxygen ffmpeg-static-libs-for-sunshine"
PKGRECOM__AMD64="${PKGRECOM} intel-media-driver"

BUILDDEP__AMD64="${BUILDDEP} cuda"
BUILDDEP__ARM64="${BUILDDEP} cuda"
PKGSUG__AMD64="cuda"
PKGSUG__ARM64="cuda"

ABTYPE=cmakeninja

# SUNSHINE_ASSETS_DIR is set to make data files follow FHS, otherwise it will
# come at /usr/assets
#
CMAKE_AFTER=(
    "-DFFMPEG_USE_SYSTEM_LIBRARIES=ON"
    "-DSUNSHINE_ENABLE_DRM=ON"
    "-DSUNSHINE_ENABLE_X11=ON"
    "-DSUNSHINE_ENABLE_WAYLAND=ON"
    "-DSUNSHINE_ENABLE_VAAPI=ON"
    "-DSUNSHINE_ASSETS_DIR=share/sunshine"
)

CMAKE_AFTER__AMD64=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=ON"
)
CMAKE_AFTER__ARM64=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=ON"
)
CMAKE_AFTER__LOONGARCH64=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=OFF"
)
CMAKE_AFTER__LOONGARCH64_NOSIMD=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=OFF"
)
CMAKE_AFTER__LOONGSON3=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=OFF"
)
CMAKE_AFTER__RISCV64=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=OFF"
)
CMAKE_AFTER__PPC64EL=(
    "${CMAKE_AFTER[@]}"
    "-DSUNSHINE_ENABLE_CUDA=OFF"
)
